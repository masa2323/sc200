質問#54 トピック3
  
次のKQLクエリがあります。  
  
![](https://img.examtopics.com/sc-200/image139.png)  
  
以下の各文について、正しい場合は「はい」を選択してください。そうでない場合は「いいえ」を選択してください。  
  
注：正しい選択は1点です。  
  
![](https://img.examtopics.com/sc-200/image140.png)

**正解:** ![](https://img.examtopics.com/sc-200/image429.png)

**解説:**
1. The `UserName` field is set as the account entity. (**はい**)
クエリの最終行に `AccountCustomEntity = UserName` という記述があります。これは、Microsoft Sentinel の分析ルールにおいて、`UserName` フィールドの値を「アカウント」エンティティとしてマッピングしていることを示しています。

2. The watchlist cannot be updated after it is created. (**いいえ**)
Microsoft Sentinel のウォッチリスト（このクエリでは `_GetWatchlist('Bad_IPs')` で呼び出されているもの）は、作成後も内容を更新、削除、または新しいデータの追加が可能です。クエリ内で呼び出されているからといって、そのデータが固定（イミュータブル）されるわけではありません。

3. The `IPList` variable is set as the IP address entity. (**いいえ**)
`IPList` は、クエリの冒頭で `let IPList = _GetWatchlist('Bad_IPs');` と定義されており、ウォッチリスト内の**IPアドレスのリスト全体**を保持する変数です。 一方で、IPアドレスエンティティとしてマッピングされているのは、クエリ末尾の `IPCustomEntity = case(...)` の部分であり、そこでは個別の `SourceIP` または `DestinationIP` が代入されています。`IPList` 変数そのものがエンティティとして設定されているわけではありません。

質問#55 トピック3
  
Microsoft Sentinelワークスペースがあります。Parser1  というカスタムAdvanced Security Information Model (ASIM)パーサーを開発し、Schema1というスキーマを生成します。Schema1 を検証する必要があります。  
  
コマンドをどのように完了すればよいですか？回答するには、回答エリアから適切なオプションを選択してください。  
  
注：正解は1つにつき1ポイントです。  
  
![](https://img.examtopics.com/sc-200/image142.png)

## 回答
ASIMスキーマを検証するには、以下のコマンドを使用します：
```kusto
Parser1 | getschema | invoke ASimSchemaTester('Schema1')
```

**回答エリアの選択:**

- 最初のドロップダウン: **getschema**
- 2番目のドロップダウン: **invoke**

### 解説
このコマンドの動作：

1. **Parser1** - カスタムASIMパーサーを実行
2. **| getschema** - パーサーの出力スキーマを取得
3. **| invoke ASimSchemaTester('Schema1')** - Schema1に対してスキーマ検証を実行

ASimSchemaTesterは、以下をチェックします：

- 必須フィールドの存在
- フィールドの型の正確性
- 必須エイリアスの存在
- 推奨フィールドとオプションフィールドの状態

検証結果により、エラー（必須フィールドの欠落や型の不一致など）や警告（推奨フィールドの欠落など）が表示され、パーサーの修正に役立ちます。

質問#56 トピック3
  
ユーザーおよびエンティティ行動分析 (UEBA) が有効になっている Microsoft Sentinel ワークスペースがあります。Server1  というサーバー上で実行された、セキュリティ上重要なユーザー操作に関連するすべてのログエントリを特定する必要があります。ソリューションは以下の要件を満たす必要があります。  
  
• IT 部門のメンバーではないユーザーによる、セキュリティ上重要な操作のみを含める。  
• 誤検知の数を最小限に抑える。  
  
クエリをどのように完了すればよいですか？回答するには、回答エリアで適切なオプションを選択してください。  

注: 正しい選択ごとに 1 ポイントが加算されます。  
  
![](https://img.examtopics.com/sc-200/image144.png)

### 回答
クエリを完成させるには、以下のように選択します：

**最初のドロップダウン（join kind）:**
- **| join kind=inner (**

**2番目のドロップダウン（テーブル）:**
- **IdentityInfo**

### 完成したクエリ:
```kusto
SecurityEvent
| where EventID in ("4624","4672")
| where Computer == "SERVER1"
| join kind=inner (
    IdentityInfo
    | summarize arg_max(TimeGenerated, *) by AccountObjectId) on $left.SubjectUserSid == $right.AccountSID
| where Department != "IT"
```

### 解説:

1. **join kind=inner** - 内部結合を使用して、SecurityEventとIdentityInfoの両方に存在するレコードのみを取得（誤検知を最小限に抑える）
2. **IdentityInfo** - UEBAが有効な場合に使用可能なテーブルで、ユーザーのプロファイル情報（部署、グループメンバーシップなど）を含む
3. *_summarize arg_max(TimeGenerated, _)__ - 各ユーザーの最新の情報を取得
4. **on $left.SubjectUserSid == $right.AccountSID** - SecurityEventのSubjectUserSidとIdentityInfoのAccountSIDで結合
5. **where Department != "IT"** - IT部門ではないユーザーのみをフィルタリング

このクエリにより、Server1でセキュリティ上重要な操作（EventID 4624: ログオン、4672: 特権でのログオン）を実行したIT部門以外のユーザーを特定できます。

質問#57 トピック3
  
Microsoft Sentinelワークスペースをお持ちです。  
過去3時間に複数の国から成功したサインインを識別するKQLクエリを作成する必要があります。
クエリはどのように完成させるべきですか？回答するには、回答エリアで適切なオプションを選択してください。   
  
注：正解は1つにつき1ポイントです。  
  
![](https://img.examtopics.com/sc-200/image146.png)

**正解:** ![](https://img.examtopics.com/sc-200/image147.png)

**解説:**
1. `imAuthentication` を選択する理由
「サインイン（ログオン）」に関する情報を取得するためには、ASIMの**認証スキーマ**を使用する必要があります。

- **imAuthentication**: ログオン、ログアウト、パスワード変更などの認証イベントを正規化するスキーマです。
- クエリの4行目に `EventType == 'Logon'` とあることからも、認証イベントを扱うこのテーブルが適切です。
- 他の `imNetworkSession`（ネットワーク通信）や `imWebSession`（HTTPリクエスト）などは、サインインの成功/失敗を判定するスキーマではありません。
    
 2. `SrcGeoCountry` を選択する理由
「複数の国から」という条件を判定するためには、接続元（ソース）の国情報をカウントする必要があります。

- **SrcGeoCountry**: サインインを試みた場所（ソース）の国名を表すASIM標準フィールドです。
- 直前の行で `isnotempty(SrcGeoCountry)` とフィルタリングされていることからも、このフィールドをカウント対象にするのが論理的です。
- **DstGeoCountry** は「宛先」の国を指すため、ユーザーがどこからアクセスしたかを判定するこのケースには適しません。
    
 完成したクエリのロジック
このクエリは、過去3時間に成功したログオンイベントを集計し、異なる送信元の国（`SrcGeoCountry`）の数（`dcount`）が5（`threshold`）以上のユーザーを抽出する、典型的な「あり得ない移動（Impossible Travel）」や「広範囲からのアクセス」を検知するためのものです。

質問#58 トピック3
  
Azureサブスクリプションを所有しています。Microsoft Sentinelワークスペースを実装する予定です。1日あたり20GBのセキュリティログデータを取り込む予定です。  
  
ワークスペースのストレージを構成する必要があります。ソリューションは、以下の要件を満たす必要があります。  
  
• 毎日取り込むデータのコストを最小限に抑える。  
• 追加コストをかけずにデータ保持期間を最大化する。  
  
各要件に対して、どのような対策を講じるべきでしょうか？回答するには、回答エリアから適切なオプションを選択してください。  
  
注：正解は1つにつき1ポイントです。  
  
![](https://img.examtopics.com/sc-200/image148.png)

**解説:**
1. 取り込みコストの最小化について

Microsoft Sentinelの「コミットメントティア（予約容量）」は、最低でも **1日あたり100GB** の取り込みを約束することで割引が適用される仕組みです。

- 今回のケースでは、取り込み予定量が **1日あたり20GB** です。
- 100GBティアを選択すると、実際には20GBしか使っていなくても100GB分の固定料金（1日約296ドル〜）を支払うことになります。
- **Pay-As-You-Go (従量課金)** モデルであれば、実際に取り込んだ20GB分のみ（1GBあたり約4.3ドル × 20GB = 1日約86ドル）の支払いで済むため、こちらのほうが低コストになります。
    
 2. データ保持期間の最大化について

Microsoft Sentinelが有効なワークスペースでは、**最初の90日間** のデータ保持が追加コストなし（無料）で提供されます。

- **31日間**: デフォルトのLog Analytics設定に近いですが、Sentinelの特典である90日間をフルに活用できていません。
- **90日間**: Sentinelの「無料保持期間」を最大限に活用できる設定です。
- **365日間**: 90日を超えた分（残りの275日分）に対して追加の保持コストが発生するため、要件の「追加コストをかけずに」に反します。

質問#59 トピック3

sws1 という Microsoft Sentinel ワークスペースがあります。sws1 でインシデントが発生した際に、オンプレミスの IT サービス管理システムでインシデントを通知する Azure ロジック アプリを作成する予定です。  
  
このロジック アプリ用に Microsoft Sentinel コネクタの資格情報を構成する必要があります。ソリューションは、以下の要件を満たす必要があります。  
  
• 管理作業を最小限に抑える。  
• 最小権限の原則を適用する。  
  
資格情報はどのように構成すればよいでしょうか？ 回答するには、回答領域から適切なオプションを選択してください。  
  
注: 正解は 1 点です。  
  
![](https://img.examtopics.com/sc-200/image150.png)

## 回答

資格情報を以下のように構成してください：

**Configure the connector to use:**
- **A managed identity**

**Role to assign to the credentials:**
- **Microsoft Sentinel Responder**

### 解説:

#### 1. **A managed identity（マネージド ID）を使用する理由:**

**管理作業を最小限に抑える:**
- マネージド IDはAzureが自動的に管理し、資格情報のローテーションや更新が不要
- サービスプリンシパルやAzure ADユーザーアカウントと比較して、パスワード管理が不要
- Logic Apps用にMicrosoft Entra IDに自動登録される

**最小権限の原則:**
- Logic Appのリソース自体に直接権限を付与
- 必要な権限のみを持つ独立したIDとして動作

**Microsoft Docsの推奨:** ドキュメントには「管理するIDの数を減らすためにこの方法を使用する」と明記されています。

#### 2. **Microsoft Sentinel Responderロールを割り当てる理由:**

**必要な権限:**
- インシデントの読み取り（トリガーの使用）✓
- インシデントの更新（通知のための書き込みアクション）✓
- IT管理システムへの通知送信のための十分な権限

**最小権限の原則:**
- **Microsoft Sentinel Reader**: 読み取り専用で不十分（インシデント更新不可）
- **Microsoft Sentinel Responder**: インシデント管理に必要な権限のみ（最小権限）
- **Microsoft Sentinel Contributor**: 過剰な権限（ソリューションのインストール、リソース作成など不要な権限を含む）

質問#60 トピック3

Microsoft Sentinelワークスペースを使用しています。  
  
組み込みのAdvanced Security Information Model（ASIM）パーサーが自動更新されないようにする必要があります。  
  
この目標を達成するための2つの方法は何ですか？ 正解はそれぞれ完全な解決策を示しています。  
  
注：正解は1つにつき1ポイントです。

- A. 組み込みパーサーを参照するハンティング クエリを作成します。
- B. カスタムの統合パーサーを構築し、組み込みパーサー バージョンを含めます。
- C. 組み込みパーサーを再デプロイし、CallerContext パラメータに Any を指定し、SourceSpecificParser パラメータに Any を指定します。
- D. 組み込みパーサーを再デプロイし、Built-in の CallerContext パラメータを指定します。
- E. 組み込みパーサーを含む分析ルールを作成します。

**解説:**
Microsoft Sentinel の ASIM (Advanced Security Information Model) において、環境の安定性を保つなどの目的で「組み込みパーサーが自動更新されたり、意図しないタイミングで仕様が変わったりするのを防ぎたい」場合、公式で案内されているアプローチがこの2つです。

1. **特定バージョンを固定する（選択肢 B）** 組み込みの統合パーサーは常に最新のパーサーを呼び出すように設計されています。自動更新の影響を受けないようにするには、カスタムの統合パーサーを自作し、その中で特定のバージョン（例: `_Im_Dns_AzureFirewallV02` のように末尾にバージョン番号が付いているもの）をハードコードして参照させます。これにより、Microsoft側で最新版がリリースされても、カスタムパーサーは指定したバージョンを使い続けます。
    
2. **除外パラメータを指定する（選択肢 C）** 組み込みパーサーの自動更新から完全にオプトアウトするための例外ルールを追加する方法です。Microsoft のドキュメントでは、`CallerContext` フィールドと `SourceSpecificParser` フィールドの両方に `Any` を指定することで、すべての組み込みパーサーの呼び出しを除外（つまり、自動更新の適用対象外として固定）できると規定されています。

質問#61 トピック3

Workbook1 というカスタム Microsoft Sentinel ワークブックがあります。
Workbook1 にグリッドを追加する必要があります。ソリューションでは、グリッドに最大 100 行が含まれるようにする必要があります。  
  
どうすればよいでしょうか？

- A. グリッド クエリに take 演算子を含めます。
- B. グリッド クエリにプロジェクト演算子を含めます。
- C. クエリ エディター インターフェイスで、設定を構成します。
- D. クエリ エディター インターフェイスで、\[詳細エディター\] を選択します。

**正解：** A [🗳️](https://www.examtopics.com/exams/microsoft/sc-200/view/19/#)  

**解説:**
Workbookのグリッド表示を最大100行に制限する方法です。
**「グリッド クエリに take 演算子を含めます」**: KQLクエリの末尾に `| take 100` （または `limit 100`）を追加することで、クエリ結果自体を100行に制限するのが最も確実かつ一般的な方法です。
※UI上の「Advanced Settings」でも表示行数を設定できますが、クエリレベルでの制御（A）が正解とされることが多いです。

質問#62 トピック3

SW1というMicrosoft Sentinelワークスペースがあります。  
  
タイムチャートを含むカスタムブックを作成する予定です。  
  
プロバイダーごとに1日あたりのセキュリティアラート数を特定するクエリを作成する必要があります。  
  
クエリはどのように完成させるべきですか？回答するには、回答エリアで適切なオプションを選択してください。  
  
注：正しい選択肢は1つにつき1ポイントです。  
  
![](https://img.examtopics.com/sc-200/image152.png)

**正解:** ![](https://img.examtopics.com/sc-200/image153.png)

**解説:**
1. `bin` を選択する理由

「1日あたり」の統計を取得するためには、連続的な時間データ（`TimeGenerated`）を特定の時間枠（この場合は `1d`）にグループ化する必要があります。

- **bin**: 数値を指定されたサイズの倍数に切り捨てる関数で、時間のバケット化（グルーピング）に標準的に使用されます。
    
- **summarize count() by ProviderName, bin(TimeGenerated, 1d)** とすることで、プロバイダーごと・日ごとのカウントが可能になります。
    
- その他の `series_add` などの関数は、集計後の動的配列（シリーズ）を操作するためのものであり、ここでのグルーピングには適しません。
    
 2. `render` を選択する理由

クエリの結果を「タイムチャート」として視覚化するためには、結果セットをどのように表示するかを指定する演算子が必要です。

- **render**: グラフやチャートを描画するための演算子です。末尾に `timechart` が指定されているため、これと組み合わせて使用します。
    
- **materialize** は中間結果のキャッシュ、**project** は列の選択、**take** は行数の制限を行うためのもので、描画には関与しません。

質問#63 トピック3

Workspace1 という Microsoft Sentinel ワークスペースがあります。  
  
組み込みの統合型 ASIM パーサーから、組み込みのソース固有の Advanced Security Information Model (ASIM) パーサーを除外する必要があります。Workspace1 には何を作成すればよいでしょうか？

- A. 解析規則
- B. ウォッチリスト
- C. ワークブック
- D. 狩猟に関する質問

**正解：** B [🗳️](https://www.examtopics.com/exams/microsoft/sc-200/view/19/#)  

**解説:**
組み込みの統合ASIMパーサーから、特定のソース固有パーサーを除外するために作成するものです。
**「ウォッチリスト (Watchlist)」**: ASIMフレームワークでは、`ASim Disabled Parsers` という名前のウォッチリストを使用して、統合パーサーから除外したいパーサーを管理します。このリストに除外したいパーサー名とCallerContextを追加することで、クエリ変更なしに動作を制御できます。

