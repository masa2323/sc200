質問#41 トピック7

オンプレミスのWindows 11 Proデバイスが1,000台あり、Microsoft Defender for Endpointにオンボードされています。Microsoft Defender XDRを使用するMicrosoft 365サブスクリプションを所有しています。  
  
攻撃者がデバイス上で以下の操作を実行したことが判明しました。  
  
• レジストリベースのウイルス対策除外のファイルシステムパスを変更した  
• 悪意のあるファイルをファイルシステムパスにダウンロードした  
  
デバイス上でライブレスポンスセッションを開始します。  
  
悪意のあるファイルを削除する必要があります。  
  
どのコマンドを実行すればよいでしょうか？

- A. 収集する
- B. getfile
- C. 元に戻す
- D. 修復する

**正解：** D [🗳️](https://www.examtopics.com/exams/microsoft/sc-200/view/40/#)  

**解説:**
Live Responseセッションで悪意のあるファイルを削除するコマンド。
**「Remediate (修復する)」**。
Live Responseには、ファイル削除などの修復アクションを実行する `remediate` コマンドが用意されています（プラットフォームやバージョンによりますが、選択肢の中で「悪意のあるファイルを処理する」コマンドとして最も適切です）。
`collect` は収集、`getfile` はダウンロード、`undo` は操作の取り消しです。
*補足*: 実際のLive Responseコマンド（Windows）では `Remediate` というコマンド自体よりも、アクションとして「Remediate」を選択するか、PowerShellで `Remove-Item` 等を使いますが、試験の選択肢として「Remediate」が正解とされています（おそらく自動修復アクションをトリガーする意図、あるいは抽象化されたコマンド）。


質問#42 トピック7

Microsoft Defender XDR を使用する Microsoft 365 サブスクリプションがあります。すべてのエンドポイントデバイスは Microsoft Defender for Endpoint にオンボードされています。Azure サブスクリプションには Workspace1 という Microsoft Sentinel ワークスペースが含まれています。すべての Microsoft Defender XDR イベントは Workspace1 に取り込まれます。Microsoft Entra テナントがあります。  
  
デバイスログで既知の脆弱性を検索する、query1 という KQL クエリを作成します。query1 が 1 時間ごとに実行されるようにする必要があります。このソリューションでは、管理作業を最小限に抑える必要があります。  
  
どのような構成を行うべきでしょうか。

- A. カスタム検出ルール
- B. 自動調査および対応（AIR）
- C. ウォッチリスト
- D. 自動化ルール

**正解：** A [🗳️](https://www.examtopics.com/exams/microsoft/sc-200/view/40/#)  

**解説:**
デバイスログ（Device Logs）で既知の脆弱性を検索するKQLクエリ（query1）を1時間ごとに定期実行する構成。
**「Custom detection rule (カスタム検出ルール)」**。
Defender XDR（旧Defender 365）のAdvanced Huntingにおいて、作成したクエリを「Detection rule」として保存することで、スケジュール実行（1時間、3時間、12時間、24時間など）を設定し、ヒットした場合にアラートやインシデントを作成できます。
「管理作業を最小限」という要件にも合致します（単にスケジュールを作成するだけ）。
Automation ruleはインシデント発生後の処理であり、Watchlistはデータ参照用、AIRはアラート後の調査です。

質問43トピック 7

Microsoft Defender XDRを使用するMicrosoft 365サブスクリプションがあり、User1というユーザーがいます。User1がセキュリティインシデントの影響を受けたデバイスのエンドポイントの脆弱性を特定できるようにする必要があります。このソリューションでは、User1にKQLの知識は必要ありません。User1 がMicrosoft Defenderポータルで順番に実行する必要がある3つのアクションはどれですか？回答するには、アクションリストから適切なアクションを回答領域に移動し、正しい順序で並べ替えてください

![[Pasted image 20260210003400.png]]

Microsoft Defender XDR（旧称 Microsoft 365 Defender）で、KQL（Kusto Query Language）の知識がないユーザーがエンドポイントの脆弱性などを調査する場合、**「高度なハンティング（Advanced hunting）」**内の**「クエリ ビルダー（Query builder）」**を使用するのが最適です。

ご質問のシナリオに基づいた正しい手順は以下の通りです。

### 回答領域に配置すべき順序

1. **Select Advanced hunting.**（高度なハンティングを選択する）
    
2. **Select Query in builder.**（ビルダーでクエリを選択する）
    
3. **Specify a data domain and a filter.**（データ ドメインとフィルターを指定する）
    
---
### 解説

- **ステップ 1:** まず、Microsoft Defender ポータルのメニューから **[高度なハンティング]** を選択します。ここがカスタム調査の入り口となります。
    
- **ステップ 2:** 「クエリ ビルダー（Query builder）」は、KQLを直接記述せずにマウス操作だけでクエリを作成できるモードです。問題文に「KQLの知識は必要ない」とあるため、**[Query in editor]** ではなく **[Query in builder]** を選択するのがポイントです。
    
- **ステップ 3:** ビルダー画面で、調査対象（デバイス、脆弱性など）の **[データ ドメイン]** を選び、特定の条件で **[フィルター]** をかけることで、目的の情報を特定します。
    
**その他のアクションについて:**

- **Select Query in editor:** KQLを直接記述するモードのため、今回の要件には適しません。
    
- **Specify a workbook:** データの可視化には使われますが、アドホックな調査の第一ステップではありません。
    
- **Select to Investigations:** インシデントの自動調査結果などを確認する場所であり、独自の条件で脆弱性を特定する手順とは異なります。

質問#44トピック 7
  
Microsoft 365 サブスクリプションをご利用です。Microsoft Defender XDR を使用して、メール関連の脅威を調査する予定です。  
  
既知の悪意のあるメールを受信して​​から 30 分以内にユーザーが行ったサインインを特定する必要があります。KQL クエリをどのように完了すればよいですか？回答するには、回答エリアで適切なオプションを選択してください。  
  
注: 正解は 1 点です。
![[Pasted image 20260210003459.png]]

## 正解の組み合わせ

1. **上部のドロップダウン**: `let`
    
2. **下部のドロップダウン**: `split`
    
---
## 解説

このクエリは、**EmailEvents** テーブルから悪意のあるメールを特定し、その受信者のアカウント名に基づいて **IdentityLogonEvents** と結合（join）することで、メール受信直後のサインイン挙動を調査するものです。

### 1. `let` ステートメントの使用

KQL において、変数やサブクエリの結果に名前を付けて、後続のクエリで再利用できるようにするには `let` を使用します。

- ここでは `MaliciousEmails = EmailEvents...` と定義することで、後の `join` 句で `MaliciousEmails` という名前を使ってこのデータセットを呼び出せるようにしています。
    
- `alias` や `set` は、このようなデータセット（テーブル変数）の定義には使用しません。
    
### 2. `split` 関数の使用

メールアドレス（`RecipientEmailAddress`）から、ドメイン部分を除いたユーザー名（エイリアス）のみを抽出する処理です。

- `split(RecipientEmailAddress, "@")[0]` と記述することで、メールアドレスを `@` で分割し、その 0 番目の要素（先頭部分）を取得しています。
    
- **例**: `user@example.com` → `split` によって `["user", "example.com"]` になり、`[0]` で `user` が返されます。
    
- `parse` や `substring` でも同様のことは可能ですが、この関数の構造（デリミタを指定し、インデックスで指定する形式）に合致するのは `split` です。

質問#45トピック 7

貴社では、1万台を超えるIoTデバイスからのアラートを管理するためにMicrosoft Sentinelを使用しています。  
  
セキュリティマネージャーから、インシデント発生件数の急増により、セキュリティ脅威の追跡がますます困難になっているという報告がありました。  
  
脅威の調査を簡素化し、機械学習を用いて脅威を推測するためのカスタム可視化機能を提供するソリューションを推奨する必要があります。  
  
推奨案にはどのような点を含めるべきでしょうか？

- A. 組み込みクエリ
- B. ライブストリーム
- C. ワークブック
- D. ブックマーク

セキュリティマネージャーからの「調査の簡素化」および「機械学習を用いた推測・可視化」という要件を満たすための最適な推奨案は **C. ワークブック** です。

Microsoft Sentinel におけるワークブック（Workbooks）は、データの可視化と分析のための強力なキャンバスを提供します。推奨案に含めるべき具体的な理由は以下の通りです。

### ワークブックを推奨する理由

- **カスタム可視化の実現**: 1万台を超える IoT デバイスからの膨大なアラートデータを、グラフやチャートを用いて一目で把握できるダッシュボードとして構築可能です。
    
- **機械学習による推測**: KQL（Kusto Query Language）の機械学習演算子（`series_decompose_anomaly` による異常検知や `series_decompose_forecast` による予測など）をクエリに組み込み、その結果をワークブック上で視覚的に表現できます。
    
- **調査の簡素化**: インタラクティブなパラメーター（時間範囲やデバイス ID のフィルタリング）を設定することで、専門知識がなくても迅速にデータを深掘り（ドリルダウン）できるようになります。
    
---
### 他の選択肢が最適ではない理由

- **A. 組み込みクエリ**: データの抽出には不可欠ですが、それ単体では視覚的なダッシュボードや、マネージャーが求める「調査を簡素化するインターフェース」としては機能しません。
    
- **B. ライブストリーム**: リアルタイムでイベントを監視するのには適していますが、過去の傾向分析や機械学習を用いた推測、カスタム可視化の提供には向きません。
    
- **D. ブックマーク**: 調査中に特定のログを後で参照するためにマークする機能であり、システム全体の可視化ソリューションではありません。

質問#46トピック 7
  
Microsoft Defender XDRを使用するMicrosoft 365サブスクリプションがあります。Microsoft Graphアクティビティログを使用して、サブスクリプション内の不審なアクティビティを調査する予定です。  
  
サブスクリプションからリソースを削除する要求を検索し、要求を開始したユーザーを特定する必要があります。KQL クエリをどのように完了すればよいですか？回答するには、回答領域で適切なオプションを選択してください。  
  
注：正しい選択ごとに1ポイントが加算されます
![[Pasted image 20260210003923.png]]

## 正解の組み合わせ

1. **上部のドロップダウン**: `matches`
    
2. **下部のドロップダウン**: `RequestUri`
    
---
## 解説

### 1. `matches` 演算子の選択

右側に `regex`（正規表現）キーワードが続いているのが大きなヒントです。

- KQL において正規表現によるパターンマッチングを行うには、**`matches regex`** 演算子を使用します。
    
- `contains` や `has` は単純な文字列検索やトークン検索用であり、正規表現をサポートしていません。
    
- この行では、特定のユーザー ID 形式（GUID 形式）に一致する `RequestUri` をフィルタリングしています。
    
### 2. `RequestUri` の選択

`project` 句は、最終的に出力したい列（カラム）を指定するステップです。

- **上部の処理を確認**: クエリの冒頭で `where RequestUri ...` とフィルタリングを行い、さらに `extend DeletedUserID = ...split(RequestUri, "/")...` として `RequestUri` から情報を抽出しています。
    
- **整合性の確認**: `AccountName` や `DistinguishedName` はこのクエリの元テーブル（MicrosoftGraphActivityLogs）にはデフォルトで存在しない、あるいは `join` 先のデータに含まれるものですが、調査の文脈上「どの URI に対してリクエストが行われたか」を示す **`RequestUri`** を含めるのが標準的です。
    
---
### SC-200 試験に向けた補足メモ

この問題のように、**MicrosoftGraphActivityLogs** を使った調査では以下のポイントがよく問われます：

- **HTTP メソッド**: `DELETE` はリソース削除、`POST` は作成、`PATCH` は更新を意味します。
    
- **正規表現の活用**: ユーザーやグループのオブジェクト ID を特定するために GUID パターンをマッチングさせることが多いです。
    
- **外部データの結合**: `join kind=leftouter (IdentityInfo ...)` を使うことで、ログに含まれる ID から具体的な「ユーザー名（DisplayName）」や「UPN」を紐付けて特定しています。

質問#47トピック 7

Microsoft 365 サブスクリプションをご利用です。
以下の表に示すデバイスを所有しています。  
  
![](https://img.examtopics.com/sc-200/image495.png)  
  
すべてのデバイスが Microsoft Defender for Endpoint にオンボードされています。
デバイスにおける潜在的なマルウェア攻撃を調査しています。
各デバイスのシステムログを確認する必要があります。解決策としては、デバイスへの影響を最小限に抑える必要があります。Microsoft Defender ポータルで各デバイスに対してまず何をすべきでしょうか？

- A. デバイスを分離します。
- B. 調査パッケージを収集します。
- C. 自動調査を開始します。
- D. ライブ応答セッションを開始します。

「デバイスへの影響を最小限に抑えつつ、システムログを確認する」という要件に基づくと、正解は **B. 調査パッケージを収集します（Collect investigation package）** です。

---
### 解説

各選択肢をこのシナリオに照らし合わせると以下のようになります。

- **B. 調査パッケージを収集します (正解)**
    
    Microsoft Defender for Endpoint の標準的な機能で、デバイスから詳細なシステムログ（イベントログ、レジストリ、実行プロセスなど）を `.zip` 形式で一括取得します。
    
    - **低負荷**: ユーザーの操作を止めることなくバックグラウンドで動作するため、デバイスへの影響が最小限です。
        
    - **広範なサポート**: 表にある Windows や macOS で利用可能です。
        
- **D. ライブ応答セッションを開始します**
    
    コマンドラインを介してリアルタイムでデバイスを調査できますが、対話型セッションが必要であり、Android や iOS では利用できないなど、全デバイス共通の「まず行うべきステップ」としては不向きです。
    
- **A. デバイスを分離します**
    
    ネットワークから切り離すため、ユーザーの業務を完全に停止させてしまいます。調査の第一歩としては影響が大きすぎます。
    
- **C. 自動調査を開始します**
    
    インシデントに対して自動で修復アクションを行いますが、システムログを「確認する」という特定の目的においては、調査パッケージの取得がより直接的な手段となります。
    
---
### SC-200 試験に向けた各デバイスの挙動

今回のようなマルチプラットフォーム環境では、OS ごとに「できること・できないこと」が異なる点がよく問われます。

| **デバイス名**   | **プラットフォーム**  | **主な調査アクション**                     |
| ----------- | ------------- | --------------------------------- |
| **Device1** | Windows 11    | フル機能（調査パッケージ、ライブ応答、分離、ウイルススキャンなど） |
| **Device2** | macOS         | 調査パッケージの収集、ライブ応答、分離などが可能          |
| **Device3** | Android / iOS | モバイル版ポータルでの警告確認や、制限付きのアクション       |
