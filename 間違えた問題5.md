質問1 トピック7

User1というユーザーとWS1というMicrosoft Sentinelワークスペースを含むAzureサブスクリプションがあります。WS1  にAdvanced Security Information Model (ASIM)認証パーサーをデプロイします。  
  
これらのパーサーを使用して、User1が過去24時間に生成した認証イベントをクエリする必要があります。ソリューションは、クエリのパフォーマンスを最大限に高める必要があります。  
  
クエリをどのように完了すればよいでしょうか？回答するには、回答エリアで適切なオプションを選択してください。  
  
注：正解は1つにつき1ポイントです。  
  
![](https://img.examtopics.com/sc-200/image254.png)

### 回答

- **1つ目のドロップダウン:** **ASimAuthentication (**
- **2つ目のドロップダウン:** **targetusername_has**

---

### 解説

このクエリを完成させるロジックは、「どの関数を呼ぶか」と「どの引数を使ってフィルタリングするか」の2点に集約されます。

#### 1. パーサーの選択 (ASimAuthentication)

ASIMにおいて、特定のスキーマ（この場合は認証：Authentication）全体を対象にクエリを投げるには、**統合パーサー（Unifying Parser）**を使用します。

- **ASimAuthentication:** 認証イベント全体を統合してクエリするための関数です。
- **imAuthentication:** 特定のソースに特化した実装パーサーを指すことが多く、広範な調査には適しません。
- **identityInfo:** これはユーザープロファイル情報を格納するテーブルであり、認証イベントそのものを調査するものではありません。

#### 2. パフォーマンスの最適化 (targetusername_has)

ASIMパーサーの大きな特徴は、関数呼び出し時に**引数によるフィルタリング（Filtering Parameters）**が可能な点です。

- **targetusername_has:** この引数に関数内で値を渡すと、データが統合される前の段階（各ソースのテーブルをスキャンする際）でフィルタリングが行われるため、クエリのパフォーマンスが劇的に向上します。
- **contains / has:** これらはKQLの演算子として関数呼び出しの「後」に `where` 句などで使われることが一般的ですが、ASIMの関数引数として直接指定することで、より早い段階でデータを絞り込めます。

質問3 トピック7
  
SW1 という Microsoft Sentinel ワークスペースがあります。SW1 では、ユーザーおよびエンティティ行動分析 (UEBA) を有効にします。KQL を使用して、次のタスクを実行する必要があります。  
  
• 各エンティティタイプのフィールドを持つエンティティデータを表示します。  
• ルールのパフォーマンスを分析して、ルールの品質を評価します。  
  
各タスクで KQL のどのテーブルを使用する必要がありますか？回答するには、適切なテーブルを正しいタスクにドラッグしてください。各テーブルは 1 回、複数回、またはまったく使用しない場合があります。コンテンツを表示するには、ペイン間の分割バーをドラッグするか、スクロールする必要がある場合があります。  
  
注: 正しい選択ごとに 1 ポイントが付与されます。  
  
![](https://img.examtopics.com/sc-200/image284.png)

### 解説

UEBA が有効なワークスペースでは、特定の分析データが専用のテーブルに格納されます。

#### 1. エンティティデータの表示 (View entity data)

**BehaviorAnalytics** テーブルを使用します。 このテーブルには、UEBA によって生成されたユーザーやホストなどのエンティティに関する情報が格納されています。各エンティティのタイプ（User, Host, IP 等）や、関連するメタデータ、ユーザーの行動傾向などの詳細フィールドが含まれており、エンティティ中心の調査を行う際の主要なソースとなります。

#### 2. ルール品質の評価 (Assess rule quality)

**Anomalies** テーブルを使用します。 Microsoft Sentinel の機械学習によって検出された「異常（Anomalies）」がこのテーブルに記録されます。これらの異常は「アラート」の前段階である場合が多く、どのような異常が検知されているかを分析することで、既存の分析ルールが適切に機能しているか、あるいはノイズが多いかといったルールの品質評価に役立てることができます。

質問4 トピック7

オンプレミスネットワークには、Active Directory Domain Services (AD DS) フォレストが含まれています。Microsoft Defender for Identity を使用する Microsoft Entra テナントがあります。AD DS フォレストはテナントと同期しています。AD DS ドメインコントローラーへの LDAP シンプルバインドを識別するハンティングクエリを作成する必要があります。  
  
どのテーブルをクエリすればよいでしょうか？

- A. AADサービスプリンシパルリスクイベント
- B. AADDomainServicesAccountLogon
- C. サインインログ
- D. アイデンティティログオンイベント

**正解：** D [🗳️](https://www.examtopics.com/exams/microsoft/sc-200/view/36/#)  

**解説:**
Defender for Identityで「LDAP Simple Bind（平文認証）」を検出するためのハンティングクエリ対象テーブル。
Defender for Identity（旧AATP）のログは **`IdentityLogonEvents`** や `IdentityQueryEvents`, `IdentityDirectoryEvents` などに統合されています。
LDAPのクリアテキストパスワード使用（Simple Bind）は、ログオン試行の一種またはディレクトリサービスへのアクセスイベントとして記録されます。
正解は **`IdentityLogonEvents`** (D) です。
LogonTypeやProtocolとして「LDAP」が含まれ、FailureReasonやAdditionalFieldsで「Clear text」が含まれるものを探します。
A, Bは存在しないかAAD関連。C（SignInLogs）はEntra ID（Azure AD）のログであり、オンプレミスADのLDAPバインドは記録されません。

質問6 トピック7

Microsoft 365 サブスクリプションで Microsoft Defender for Endpoint プラン 2 が利用されており、Device1 という macOS デバイスが含まれています。Device1 で発生した Defender for Endpoint エージェントのアラートを調査する必要があります。このソリューションは、以下の要件を満たす必要があります。  
  
• Device1 上のアクティブなネットワーク接続をすべて特定する。  
• Device1 で実行中のプロセスをすべて特定する。  
• Device1 のログイン履歴を取得する。  
• 管理作業を最小限に抑える。

Microsoft Defender ポータルから最初に行うべきことは何でしょうか？

- A. \[デバイス\] から、\[デバイス 1 の調査パッケージの収集\] をクリックします。
- B. エンドポイントの高度な機能から、Live Response の署名されていないスクリプトの実行を有効にします。
- C. デバイスから、デバイス 1 でライブ応答セッションを開始します。
- D. エンドポイントの高度な機能から、認証済みテレメトリを無効にします。

### **正解：A. [デバイス] から、[デバイス 1 の調査パッケージの収集] をクリックします。**

## 理由

公式ドキュメントの「Investigation package contents for Mac and Linux devices」セクションに、macOSデバイスの調査パッケージに含まれる内容が明確に記載されています：

### **macOSの調査パッケージに含まれる内容**

|Object|macOS|
|---|---|
|**Network connections**|✅ Active connections  <br>✅ Active listening connections  <br>✅ ARP table  <br>✅ Firewall rules  <br>✅ Interface configuration  <br>✅ Proxy settings  <br>✅ VPN settings|
|**Processes**|✅ A list of all running processes|
|**Users and groups**|✅ **Sign-in history**  <br>✅ Sudoers|

### **要件の確認**

調査パッケージの収集により、以下のすべての要件が満たされます：

1. ✅ **Device1上のアクティブなネットワーク接続をすべて特定する**
    - "Active connections" が含まれています
2. ✅ **Device1で実行中のプロセスをすべて特定する**
    - "A list of all running processes" が含まれています
3. ✅ **Device1のログイン履歴を取得する**
    - "Sign-in history" が含まれています
4. ✅ **管理作業を最小限に抑える**
    - 調査パッケージの収集は**1回のアクション**で完了します
    - すべての情報がZIPファイルとしてまとめてダウンロードされます

### **他の選択肢が不適切な理由**

#### **B. エンドポイントの高度な機能から、Live Response の署名されていないスクリプトの実行を有効にします。**

- これは設定の変更であり、実際の調査アクションではありません
- 署名されていないスクリプトを実行する必要性がありません
- この設定を有効にしても、要件の情報は取得できません

#### **C. デバイスから、デバイス 1 でライブ応答セッションを開始します。**

- ライブ応答セッションでも情報は取得できますが、管理作業が増えます
- 複数のコマンド（`processes`、ログイン履歴の取得など）を手動で実行する必要があります
- **重要な問題**：ライブ応答の基本コマンドである`connections`は、**macOSではサポートされていません** ドキュメントには明確に記載されています：

    |Command|Windows|macOS|Linux|
    |---|---|---|---|
    |`connections`|Y|**N**|N|

    つまり、ライブ応答セッションではmacOSのネットワーク接続情報を取得できません

#### **D. エンドポイントの高度な機能から、認証済みテレメトリを無効にします。**

- これは全く関係のない設定です
- 調査には何も役立ちません

### **まとめ**

**調査パッケージの収集**は：

- 1回のクリックで完了（管理作業最小）
- すべての要件を満たす情報を含む
- macOSデバイスで完全にサポートされている
- ネットワーク接続、プロセス、ログイン履歴のすべてが含まれる

質問11 トピック7

RG1 というリソースグループを含む Azure サブスクリプションがあります。RG1 には Microsoft Sentinel ワークスペースが含まれています。このサブスクリプションは、User1 というユーザーを含む Microsoft Entra テナントにリンクされています。User1 が Microsoft Sentinel ブックテンプレートをデプロイおよびカスタマイズできるようにする必要があります。このソリューションは、最小権限の原則に従う必要があります。RG1 において、User1 にどのロールを割り当てるべきでしょうか？

- A. Microsoft Sentinel 貢献者
- B. ワ​​ークブック寄稿者
- C. Microsoft Sentinel Automation 貢献者
- D. 貢献者

### **正解：B. ワークブック寄稿者 (Workbook Contributor)**

## 理由

公式ドキュメントに明確に記載されています：

### **ワークブックの作成/削除に必要なロール**

> "**Create/delete workbooks**: [Microsoft Sentinel Contributor](https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles#microsoft-sentinel-contributor) or a lesser Microsoft Sentinel role **AND** [Workbook Contributor](https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles#workbook-contributor)"

### **前提条件セクションより**

> "You must have at least **Workbook reader** or **Workbook contributor** permissions on the resource group of the Microsoft Sentinel workspace."

## 最小権限の原則による分析

### **要件:**

- ワークブックテンプレートをデプロイする
- ワークブックをカスタマイズする
- 最小権限の原則に従う

### **各選択肢の評価:**

#### **A. Microsoft Sentinel Contributor（Microsoft Sentinel 貢献者）**

- ❌ **過剰な権限**
- アナリティクスルール、インシデント管理、コンテンツハブ管理など、ワークブック以外の多くの権限が含まれます
- ドキュメント表の「Create/edit analytics rules, workbooks, etc.」列で ✓ となっています
- 最小権限の原則に**違反**します

#### **B. Workbook Contributor（ワークブック寄稿者）** ✅

- ✅ **最小権限**
- ワークブックの作成、編集、削除に**特化**した権限のみ
- ワークブックテンプレートのデプロイとカスタマイズに**必要十分**
- 他のMicrosoft Sentinelリソース（アナリティクスルール、インシデントなど）への不要な権限は含まない
- 最小権限の原則に**完全に準拠**

#### **C. Microsoft Sentinel Automation Contributor（Microsoft Sentinel Automation 貢献者）**

- ❌ **関係ない権限**
- "Allows Microsoft Sentinel to add playbooks to automation rules. Not used for user accounts."
- ユーザーアカウントには使用されない
- オートメーションルールにプレイブックを追加するための権限で、ワークブックとは無関係

#### **D. Contributor（貢献者）**

- ❌ **過剰な権限**
- リソースグループ内のすべてのリソースへの広範なアクセス権限
- ワークブック以外の多くのリソース（VM、ストレージ、ネットワークなど）への権限が含まれます
- 最小権限の原則に大きく**違反**します

## まとめ

公式ドキュメントの権限要件表より：

|ロール|ワークブックの作成/編集|
|---|---|
|Microsoft Sentinel Reader|❌ (Workbook Contributorとの組み合わせで可能*)|
|Microsoft Sentinel Responder|❌ (Workbook Contributorとの組み合わせで可能*)|
|Microsoft Sentinel Contributor|✓|
|**Workbook Contributor**|**✓** (単独で可能)|

*ドキュメント注記: "With Workbook Contributor role"

**Workbook Contributor**ロールは：

- ✅ ワークブックテンプレートをデプロイできる
- ✅ ワークブックをカスタマイズ（作成、編集、削除）できる
- ✅ ワークブックに特化した最小権限のロール
- ✅ 不要な権限を含まない

質問#28 トピック7

Microsoft Sentinel ワークスペースを含む Azure サブスクリプションがあります。Microsoft Entra ID 監査ログ用のワークブックを作成してカスタマイズする必要があります。  
  
どの 3 つのアクションを順番に実行する必要がありますか？ 回答するには、アクションリストから適切なアクションを回答領域に移動し、正しい順序に並べ替えてください。  
  
![](https://img.examtopics.com/sc-200/image403.png)

### 回答：実行すべき 3 つのアクションとその順序

1. **From Content hub, install the Microsoft Entra ID solution.**
2. **From Workbooks, select Microsoft Entra ID Audit logs and then select View Template.**
3. **From Workbooks, select Microsoft Entra ID Audit logs and then select Save.**

---

### 解説：なぜこの順序になるのか

- **ステップ 1 (Content hub):** 現在の Microsoft Sentinel では、ワークブックのテンプレートやデータコネクタなどのアセットは「コンテンツハブ (Content hub)」から **ソリューションとしてインストール** する必要があります。これにより、ワークブックのテンプレートがギャラリーに表示されるようになります。
- **ステップ 2 (View Template):** ギャラリー（Workbooks）に表示されたテンプレートを選択し、まずは「**テンプレートを表示 (View Template)**」をクリックして内容を確認します。テンプレートの状態ではまだ編集やカスタマイズはできません。
- **ステップ 3 (Save):** テンプレート画面で「**保存 (Save)**」をクリックすることで、自分のワークスペース内にそのワークブックのインスタンス（コピー）が作成されます。保存して初めて、クエリの書き換えや視覚化の変更といった「カスタマイズ」が可能になります。

質問#31 トピック7

Microsoft Defender XDR を使用する Microsoft 365 サブスクリプションを所有しています。このサブスクリプションには、Microsoft Defender for Endpoint にオンボードされている 500 台の Windows 11 デバイスが含まれています。  
  
これらのデバイスの Administrators グループのメンバーシップに不正な変更が加えられていることを発見しました。  
  
以下の要件を満たすソリューションを構成する必要があります。  
  
• 各エンドポイントの Administrators グループのメンバーシップを 1 時間ごとに確認する。  
• Administrators グループのメンバーシップの変更が検出されたら、Microsoft Defender XDR でインシデントを作成する。  
  
まず何を作成すればよいでしょうか？

- A. デバイスグループ
- B. 高度なハンティングクエリ
- C. アラート調整ルール
- D. 検出ルール

### 正解の理由：B. 高度なハンティングクエリ

このソリューションの核となるのは「**カスタム検出ルール (Custom detection rule)**」ですが、Microsoft Defender XDR ポータルのワークフロー上、それを設定するためには**まずクエリを作成して実行する**必要があります。

1. **ロジックの定義:** メンバーシップの変更（例：`DeviceEvents` テーブルの `LocalGroupMemberAdded` アクションなど）を特定するための KQL クエリを記述します。
2. **ルールの作成:** クエリを実行し、結果が表示された状態で初めて「**検出ルールの作成 (Create detection rule)**」ボタンがアクティブになります。
3. **スケジュールの設定:** ルールの作成画面の中で、要件にある「1時間ごと」のチェック頻度や「インシデントの作成」などのアクションを設定します。

つまり、クエリ（B）がなければ、ルール（D）を作成・構成すること自体ができないため、「まず（First）」作成すべきものはクエリとなります。

---

### 他の選択肢が最適ではない理由

- **A. デバイスグループ:** デバイスを論理的にグループ化（タグ付けや権限管理用）するものですが、メンバーシップの監視やインシデント作成のロジックとは直接関係ありません。
- **C. アラート調整ルール (Alert tuning rules):** 既存のアラートを抑制したり、誤検知を減らしたりするための設定です。新しい検知ロジックを作成するものではありません。
- **D. 検出ルール:** 最終的なソリューションそのものですが、前述の通り、これを作成するための「入力データ」として高度なハンティングクエリを先に用意する必要があります。

質問#42 トピック7

Microsoft Defender XDR を使用する Microsoft 365 サブスクリプションがあります。すべてのエンドポイントデバイスは Microsoft Defender for Endpoint にオンボードされています。Azure サブスクリプションには Workspace1 という Microsoft Sentinel ワークスペースが含まれています。すべての Microsoft Defender XDR イベントは Workspace1 に取り込まれます。Microsoft Entra テナントがあります。  
  
デバイスログで既知の脆弱性を検索する、query1 という KQL クエリを作成します。query1 が 1 時間ごとに実行されるようにする必要があります。このソリューションでは、管理作業を最小限に抑える必要があります。  
  
どのような構成を行うべきでしょうか。

- A. カスタム検出ルール
- B. 自動調査および対応（AIR）
- C. ウォッチリスト
- D. 自動化ルール

**正解：** A [🗳️](https://www.examtopics.com/exams/microsoft/sc-200/view/40/#)  

**解説:**
デバイスログ（Device Logs）で既知の脆弱性を検索するKQLクエリ（query1）を1時間ごとに定期実行する構成。
**「Custom detection rule (カスタム検出ルール)」**。
Defender XDR（旧Defender 365）のAdvanced Huntingにおいて、作成したクエリを「Detection rule」として保存することで、スケジュール実行（1時間、3時間、12時間、24時間など）を設定し、ヒットした場合にアラートやインシデントを作成できます。
「管理作業を最小限」という要件にも合致します（単にスケジュールを作成するだけ）。
Automation ruleはインシデント発生後の処理であり、Watchlistはデータ参照用、AIRはアラート後の調査です。

質問#46トピック 7
  
Microsoft Defender XDRを使用するMicrosoft 365サブスクリプションがあります。Microsoft Graphアクティビティログを使用して、サブスクリプション内の不審なアクティビティを調査する予定です。  
  
サブスクリプションからリソースを削除する要求を検索し、要求を開始したユーザーを特定する必要があります。KQL クエリをどのように完了すればよいですか？回答するには、回答領域で適切なオプションを選択してください。  
  
注：正しい選択ごとに1ポイントが加算されます
![[Pasted image 20260210003923.png]]

## 正解の組み合わせ

1. **上部のドロップダウン**: `matches`
2. **下部のドロップダウン**: `RequestUri`

---

## 解説

### 1. `matches` 演算子の選択

右側に `regex`（正規表現）キーワードが続いているのが大きなヒントです。

- KQL において正規表現によるパターンマッチングを行うには、**`matches regex`** 演算子を使用します。
- `contains` や `has` は単純な文字列検索やトークン検索用であり、正規表現をサポートしていません。
- この行では、特定のユーザー ID 形式（GUID 形式）に一致する `RequestUri` をフィルタリングしています。

### 2. `RequestUri` の選択

`project` 句は、最終的に出力したい列（カラム）を指定するステップです。

- **上部の処理を確認**: クエリの冒頭で `where RequestUri ...` とフィルタリングを行い、さらに `extend DeletedUserID = ...split(RequestUri, "/")...` として `RequestUri` から情報を抽出しています。
- **整合性の確認**: `AccountName` や `DistinguishedName` はこのクエリの元テーブル（MicrosoftGraphActivityLogs）にはデフォルトで存在しない、あるいは `join` 先のデータに含まれるものですが、調査の文脈上「どの URI に対してリクエストが行われたか」を示す **`RequestUri`** を含めるのが標準的です。

---

### SC-200 試験に向けた補足メモ

この問題のように、**MicrosoftGraphActivityLogs** を使った調査では以下のポイントがよく問われます：

- **HTTP メソッド**: `DELETE` はリソース削除、`POST` は作成、`PATCH` は更新を意味します。
- **正規表現の活用**: ユーザーやグループのオブジェクト ID を特定するために GUID パターンをマッチングさせることが多いです。
- **外部データの結合**: `join kind=leftouter (IdentityInfo ...)` を使うことで、ログに含まれる ID から具体的な「ユーザー名（DisplayName）」や「UPN」を紐付けて特定しています。
